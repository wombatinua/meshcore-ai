<!doctype html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>MeshCore Control</title>
	<link rel="stylesheet" href="index.css">
</head>

<body>
	<main>
		<h1>MeshCore Control</h1>
		<section class="panel">
			<form id="action-form" class="action-form">
				<div class="field">
					<label for="action">Action</label>
					<select id="action" name="action">
						<option value="">Select action</option>
					</select>
				</div>
				<div class="field">
					<label for="params">Params (JSON or text)</label>
					<input id="params" name="params" placeholder='{"foo":"bar"}'>
				</div>
				<button id="action-submit" type="submit">Send</button>
			</form>
		</section>
		<div id="action-status" class="panel"></div>
	</main>

	<script type="module">

			// backend actionHandlers list
			const availableActions = [
				"apiReboot",
				"apiSyncDeviceTime",
				"apiSendFloodAdvert",
				"apiSendZeroHopAdvert",
				"apiGetContacts",
				"apiGetChannels",
				"apiJoinPrivateChannel",
				"apiRemoveChannel",
				"apiQueryAiGate",
				"apiGetAdverts",
				"apiGetMessages"
			];

		const form = document.getElementById("action-form");
		const status = document.getElementById("action-status");
		const actionSelect = document.getElementById("action");
		const paramsInput = document.getElementById("params");

		availableActions.forEach((name) => {
			const option = document.createElement("option");
			option.value = name;
			option.textContent = name;
			actionSelect.appendChild(option);
		});

		form.addEventListener("submit", async (event) => {

			event.preventDefault();
			status.textContent = "Sending...";

			try {
				const action = (actionSelect.value || "").trim();
				if (!action) {
					status.textContent = "Select an action";
					return;
				}

				let params = paramsInput.value;

				try {
					if (params) params = JSON.parse(params);
				} catch {
					// leave as raw string if not valid JSON
				}

				const response = await fetch("/api", {
					method: "POST",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({ action, params })
				});

				const data = await response.json();
				status.textContent = data.ok
					? JSON.stringify(data.result ?? data, null, 2)
					: data.error || "Request failed";
			} catch (error) {
				status.textContent = error.message;
			}
			});
	</script>
</body>

</html>
